<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯</title>
    <style>
        :root {
            --ios-blue: #007AFF;
            --ios-bg: #F2F2F7;
            --card-bg: #FFFFFF;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--ios-bg);
            margin: 0;
            padding: 20px;
            direction: rtl;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
        }

        .back-btn {
            background: #e5e5ea;
            color: #1c1c1e;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            font-size: 20px;
            font-weight: bold;
        }

        .header h1 {
            font-size: 20px;
            margin: 0;
            flex: 1;
            text-align: center;
            margin-right: -40px; /* Ù„Ù…ÙˆØ§Ø²Ù†Ø© Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© */
        }

        /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
        .form-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #3a3a3c;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 15px;
            box-sizing: border-box;
            outline: none;
            transition: 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            border-color: var(--ios-blue);
        }

        .image-preview {
            width: 100%;
            height: 180px;
            background: #f0f0f5;
            border-radius: 15px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px dashed #ccc;
            cursor: pointer;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .publish-btn {
            width: 100%;
            padding: 15px;
            background: var(--ios-blue);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .publish-btn:disabled {
            background: #ccc;
        }

        /* Ø£Ù„ÙˆØ§Ù† Ø®Ø§ØµØ© Ù„Ù„Ø£Ù†ÙˆØ§Ø¹ */
        select option[value="wedding"] { color: #b8860b; }
        select option[value="death"] { color: #000; font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <a href="news.html" class="back-btn">âœ•</a>
        <h1>Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø´ÙˆØ±</h1>
    </div>

    <div class="form-container">
        <div class="input-group">
            <label>ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
            <select id="postType">
                <option value="normal">Ø®Ø¨Ø± Ø¹Ø§Ø¯ÙŠ ğŸ“„</option>
                <option value="wedding">Ø¯Ø¹ÙˆØ© Ø²ÙˆØ§Ø¬ ğŸ’</option>
                <option value="death">Ø¥Ø¹Ù„Ø§Ù† ÙˆÙØ§Ø© ğŸ–¤</option>
            </select>
        </div>

        <div class="input-group">
            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
            <input type="text" id="postTitle" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ Ø¬Ø°Ø§Ø¨Ø§Ù‹...">
        </div>

        <div class="input-group">
            <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Image URL)</label>
            <input type="text" id="postImg" placeholder="https://example.com/image.jpg">
            <div class="image-preview" onclick="document.getElementById('postImg').focus()">
                <span id="placeholderText">Ø³ÙŠØ¸Ù‡Ø± Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§</span>
                <img id="previewImg" style="display:none;">
            </div>
        </div>

        <div class="input-group">
            <label>Ø§Ù„ØªÙØ§ØµÙŠÙ„</label>
            <textarea id="postBody" rows="6" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¨Ø± Ù‡Ù†Ø§..."></textarea>
        </div>

        <button id="publishBtn" class="publish-btn">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
    </div>

    <script type="module">
        import { db, auth } from './config.js';
        import { collection, addDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const previewImg = document.getElementById('previewImg');
        const postImgInput = document.getElementById('postImg');
        const placeholderText = document.getElementById('placeholderText');

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ ÙˆØ¶Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø·
        postImgInput.addEventListener('input', () => {
            if (postImgInput.value) {
                previewImg.src = postImgInput.value;
                previewImg.style.display = 'block';
                placeholderText.style.display = 'none';
            } else {
                previewImg.style.display = 'none';
                placeholderText.style.display = 'block';
            }
        });

        document.getElementById('publishBtn').onclick = async () => {
            const title = document.getElementById('postTitle').value.trim();
            const body = document.getElementById('postBody').value.trim();
            const img = document.getElementById('postImg').value.trim();
            const type = document.getElementById('postType').value;

            if (!title || !body) {
                alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„");
                return;
            }

            const btn = document.getElementById('publishBtn');
            btn.disabled = true;
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...";

            try {
                const user = auth.currentUser;
                let authorName = "Ø¹Ø¶Ùˆ";
                
                if (user) {
                    const userSnap = await getDoc(doc(db, "Users", user.uid));
                    if (userSnap.exists()) {
                        authorName = userSnap.data().fullName || userSnap.data().name || "Ø¹Ø¶Ùˆ";
                    }

                    await addDoc(collection(db, "News"), {
                        title: title,
                        body: body,
                        img: img || "https://via.placeholder.com/500x300",
                        type: type, // Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                        authorId: user.uid,
                        authorName: authorName,
                        publishDate: Date.now(),
                        visible: true,
                        likedBy: [],
                        viewedBy: [],
                        comments: []
                    });

                    alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!");
                    window.location.href = "news.html";
                }
            } catch (error) {
                console.error("Error:", error);
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±");
                btn.disabled = false;
                btn.innerText = "Ù†Ø´Ø± Ø§Ù„Ø¢Ù†";
            }
        };
    </script>
</body>
</html>
