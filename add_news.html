<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; }
        .form-card { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-post { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        #preview { width: 100%; max-height: 150px; object-fit: cover; border-radius: 10px; margin: 10px 0; display: none; }
    </style>
</head>
<body>

<div class="form-card">
    <h2 style="text-align:center;">Ù†Ø´Ø± Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯ ğŸ“°</h2>
    <input type="text" id="newsTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¨Ø±">
    
    <label>ØµÙˆØ±Ø© Ø§Ù„Ø®Ø¨Ø± (Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²):</label>
    <input type="file" id="newsImgFile" accept="image/*" onchange="processImage()">
    <img id="preview">
    <input type="hidden" id="newsImgBase64"> <textarea id="newsBody" rows="5" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±..."></textarea>
    <button class="btn-post" onclick="publishNews()">Ù†Ø´Ø± Ø§Ù„Ø®Ø¨Ø± Ø§Ù„Ø¢Ù†</button>
</div>

<script type="module">
    import { db, auth } from './config.js';
    import { collection, addDoc, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    window.processImage = () => {
        const file = document.getElementById('newsImgFile').files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            document.getElementById('newsImgBase64').value = reader.result;
            document.getElementById('preview').src = reader.result;
            document.getElementById('preview').style.display = 'block';
        }
        if (file) reader.readAsDataURL(file);
    };

    window.publishNews = async () => {
        const title = document.getElementById('newsTitle').value;
        const imgData = document.getElementById('newsImgBase64').value;
        const body = document.getElementById('newsBody').value;

        if(!title || !imgData || !body) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ø®ØªØ± ØµÙˆØ±Ø©");

        const uSnap = await getDoc(doc(db, "Users", auth.currentUser.uid));
        const uName = uSnap.data().fullName;

        await addDoc(collection(db, "News"), {
            title, img: imgData, body,
            authorId: auth.currentUser.uid,
            authorName: uName, // Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø±Ø±
            date: serverTimestamp(),
            likes: 0
        });
        alert("ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­");
        window.location.href = "news.html";
    };
</script>
</body>
</html>
