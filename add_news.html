<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; }
        .form-card { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-post { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="form-card">
    <h2 style="text-align:center;">Ù†Ø´Ø± Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯ ğŸ“°</h2>
    
    <input type="text" id="newsTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¨Ø±">
    
    <label style="font-size: 13px; color: #666;">Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙ Ø§Ù„Ø®Ø¨Ø±:</label>
    <select id="newsCategory">
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ --</option>
    </select>
    
    <input type="text" id="newsImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø®Ø¨Ø±">
    <textarea id="newsBody" rows="5" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±..."></textarea>
    
    <button class="btn-post" onclick="publishNews()">Ù†Ø´Ø± Ø§Ù„Ø®Ø¨Ø± Ø§Ù„Ø¢Ù†</button>
    <button onclick="history.back()" style="width:100%; margin-top:10px; border:none; background:none; cursor:pointer; color:#777;">Ø¥Ù„ØºØ§Ø¡</button>
</div>

<script type="module">
    import { db, auth } from './config.js';
    import { collection, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // 1. Ø¬Ù„Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    const catSelect = document.getElementById('newsCategory');
    onSnapshot(collection(db, "Categories"), (snap) => {
        catSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ --</option>';
        snap.forEach(doc => {
            const cat = doc.data();
            catSelect.innerHTML += `<option value="${cat.name}">${cat.name}</option>`;
        });
    });

    // 2. Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø±
    window.publishNews = async () => {
        const title = document.getElementById('newsTitle').value;
        const category = document.getElementById('newsCategory').value;
        const img = document.getElementById('newsImg').value;
        const body = document.getElementById('newsBody').value;

        if(!title || !category || !body) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙ");

        try {
            await addDoc(collection(db, "News"), {
                title,
                category,
                img: img || "https://via.placeholder.com/150",
                body,
                author: auth.currentUser.uid,
                date: serverTimestamp(),
                likes: 0
            });
            alert("ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø®Ø¨Ø± Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ ØªØµÙ†ÙŠÙ " + category);
            window.location.href = "news.html";
        } catch (e) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø´Ø±");
        }
    };
</script>
</body>
</html>
