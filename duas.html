<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© | Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Cairo&family=Tajawal&family=Reem+Kufi&family=Almarai&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --ios-blue: #007AFF; --ios-bg: #F2F2F7; --card-bg: #FFFFFF;
            --text-color: #1c1c1e; --font-size: 24px;
        }

        body.normal-vision { --ios-bg: #F2F2F7; --text-color: #1c1c1e; --card-bg: #FFFFFF; }
        body.low-vision { --ios-bg: #000000; --text-color: #FFFF00; --card-bg: #1c1c1e; }
        body.color-blind { --ios-bg: #E1E1E1; --text-color: #000000; --ios-blue: #0055AA; }

        body { background-color: var(--ios-bg); font-family: 'Cairo', sans-serif; margin: 0; padding-top: 70px; transition: 0.3s; }

        .header { position: fixed; top: 0; width: 100%; height: 65px; background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); display: flex; justify-content: space-between; align-items: center; padding: 0 15px; box-sizing: border-box; border-bottom: .5px solid #C6C6C8; z-index: 1000; }

        .drawer { position: fixed; top: 0; right: -280px; width: 280px; height: 100%; background: var(--card-bg); box-shadow: -5px 0 15px rgba(0,0,0,0.1); transition: 0.3s; z-index: 2000; padding-top: 60px; }
        .drawer.open { right: 0; }
        .drawer-item { padding: 18px 20px; border-bottom: 0.5px solid #eee; cursor: pointer; color: var(--text-color); font-weight: 600; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ (Ù„Ù†Ù…Ø· Ø§Ù„Ø±Ø¤ÙŠØ© ÙÙ‚Ø·) */
        .toolbar { background: var(--card-bg); margin: 10px; padding: 12px; border-radius: 15px; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .tool-btn { border: none; background: #eee; padding: 8px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }

        .dua-item-row { padding: 18px 20px; background: var(--card-bg); margin: 10px 15px; border-radius: 15px; border: 0.5px solid #E5E5EA; display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: bold; }

        /* Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ø§Ø¡ */
        #fullDuaView { position: fixed; inset: 0; background: var(--ios-bg); z-index: 3000; display: none; flex-direction: column; padding: 20px; overflow-y: auto; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ø¯Ø§Ø®Ù„ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø¹Ø§Ø¡ */
        .dua-controls { display: flex; gap: 10px; align-items: center; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 12px; margin-bottom: 15px; flex-wrap: wrap; }
        .font-select { padding: 5px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; flex: 1; min-width: 120px; }

        .dua-full-text { line-height: 1.8; text-align: justify; white-space: pre-wrap; color: var(--text-color); margin-top: 20px; transition: 0.2s; }
        
        .back-footer { text-align: center; margin-top: 40px; padding: 20px; border-top: 1px dashed #ccc; cursor: pointer; color: var(--ios-blue); font-weight: bold; }

        .overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1500; }
    </style>
</head>
<body class="normal-vision">

    <header class="header">
        <div onclick="toggleDrawer()" style="font-size: 28px; cursor: pointer; color: var(--ios-blue);">â˜°</div>
        <h1 style="font-size: 18px; margin: 0; color: var(--text-color);">Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø±</h1>
        <div onclick="location.href='news.html'" style="font-size: 24px; cursor: pointer;">ğŸ </div>
    </header>

    <div class="toolbar">
        <span style="font-size: 14px; font-weight: bold;">Ù†Ù…Ø· Ø§Ù„Ø¹Ø±Ø¶:</span>
        <select onchange="changeVision(this.value)" class="tool-btn">
            <option value="normal-vision">Ù†Ø¸Ù€Ø± Ø·Ø¨ÙŠØ¹ÙŠ</option>
            <option value="low-vision">Ø¶Ø¹Ù Ø¨ØµØ±</option>
            <option value="color-blind">Ø¹Ù…Ù‰ Ø£Ù„ÙˆØ§Ù†</option>
        </select>
    </div>

    <div id="drawerOverlay" class="overlay" onclick="toggleDrawer()"></div>
    <div id="drawer" class="drawer">
        <div style="padding: 20px; font-weight: 800; border-bottom: 2px solid var(--ios-blue); color: var(--ios-blue);">ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</div>
        <div id="categoriesList"></div>
    </div>

    <div id="duasContainer">
        <p style="text-align: center; margin-top: 50px; color: gray;">Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙØ§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© â˜°</p>
    </div>

    <div id="fullDuaView">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
            <button onclick="closeFullDua()" style="border:none; background:var(--ios-blue); color:white; padding:8px 18px; border-radius:10px; font-weight:bold;">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
            <h2 id="viewDuaTitle" style="margin:0; font-size:18px;"></h2>
        </div>

        <div class="dua-controls">
            <button class="tool-btn" onclick="changeFontSize(4)">A+</button>
            <button class="tool-btn" onclick="changeFontSize(-4)">A-</button>
            <select id="fontFamilySelect" class="font-select" onchange="changeFontFamily(this.value)">
                <option value="'Amiri', serif">Ø®Ø· Ø£Ù…ÙŠØ±ÙŠ (Ø¯ÙŠÙ†ÙŠ)</option>
                <option value="'Cairo', sans-serif">Ø®Ø· ÙƒØ§ÙŠØ±Ùˆ (Ù…ÙˆØ¯Ø±Ù†)</option>
                <option value="'Tajawal', sans-serif">Ø®Ø· ØªØ¬ÙˆÙ„ (Ù†Ø§Ø¹Ù…)</option>
                <option value="'Almarai', sans-serif">Ø®Ø· Ø§Ù„Ù…Ø±Ø§Ø¹ÙŠ (ÙˆØ§Ø¶Ø­)</option>
                <option value="'Reem Kufi', sans-serif">Ø®Ø· Ø±ÙŠÙ… ÙƒÙˆÙÙŠ (Ù…Ù…ÙŠØ²)</option>
            </select>
        </div>

        <div id="viewDuaText" class="dua-full-text"></div>
        
        <div class="back-footer" onclick="closeFullDua()">
             ğŸ”š Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¯Ø¹Ø§Ø¡ - Ø§Ø¶ØºØ· Ù„Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
        </div>
    </div>

<script type="module">
    import { db } from './config.js';
    import { collection, onSnapshot, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    let currentFontSize = 24;

    onSnapshot(collection(db, "DuaCategories"), (snap) => {
        const list = document.getElementById('categoriesList');
        list.innerHTML = "";
        snap.forEach(doc => {
            const cat = doc.data();
            const div = document.createElement('div');
            div.className = 'drawer-item';
            div.innerText = cat.name;
            div.onclick = () => { loadTitles(cat.name); toggleDrawer(); };
            list.appendChild(div);
        });
    });

    window.loadTitles = async (categoryName) => {
        const container = document.getElementById('duasContainer');
        container.innerHTML = `<h3 style="text-align:center; color:var(--ios-blue); margin: 20px 0;">Ù‚Ø³Ù…: ${categoryName}</h3>`;
        const q = query(collection(db, "Duas"), where("category", "==", categoryName));
        const snap = await getDocs(q);
        if (snap.empty) { container.innerHTML += "<p style='text-align:center;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ø¹ÙŠØ©.</p>"; return; }

        snap.forEach(docSnap => {
            const dua = docSnap.data();
            const div = document.createElement('div');
            div.className = 'dua-item-row';
            div.innerHTML = `<span>${dua.title}</span> <span style="color:var(--ios-blue);">â†</span>`;
            div.onclick = () => showFullDua(dua.title, dua.text);
            container.appendChild(div);
        });
    };

    window.showFullDua = (title, text) => {
        const view = document.getElementById('fullDuaView');
        view.style.display = 'flex';
        view.scrollTop = 0;
        document.getElementById('viewDuaTitle').innerText = title;
        const txtEl = document.getElementById('viewDuaText');
        txtEl.innerText = text;
        txtEl.style.fontSize = currentFontSize + 'px';
        txtEl.style.color = getComputedStyle(document.body).getPropertyValue('--text-color');
        view.style.backgroundColor = getComputedStyle(document.body).getPropertyValue('--ios-bg');
    };

    window.closeFullDua = () => { document.getElementById('fullDuaView').style.display = 'none'; };

    window.changeFontSize = (step) => {
        currentFontSize += step;
        if(currentFontSize < 16) currentFontSize = 16;
        if(currentFontSize > 60) currentFontSize = 60;
        document.getElementById('viewDuaText').style.fontSize = currentFontSize + 'px';
    };

    window.changeFontFamily = (font) => {
        document.getElementById('viewDuaText').style.fontFamily = font;
    };

    window.changeVision = (mode) => {
        document.body.className = mode;
        const view = document.getElementById('fullDuaView');
        if(view.style.display === 'flex') {
            view.style.backgroundColor = getComputedStyle(document.body).getPropertyValue('--ios-bg');
            document.getElementById('viewDuaText').style.color = getComputedStyle(document.body).getPropertyValue('--text-color');
        }
    };

    window.toggleDrawer = () => {
        document.getElementById('drawer').classList.toggle('open');
        const o = document.getElementById('drawerOverlay');
        o.style.display = o.style.display === 'block' ? 'none' : 'block';
    };
</script>
</body>
</html>
