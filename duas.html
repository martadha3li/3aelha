<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© | Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --ios-blue: #007AFF; --ios-bg: #F2F2F7; --card-bg: #FFFFFF;
            --text-color: #1c1c1e; --font-size: 20px;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø±Ø¤ÙŠØ© */
        body.normal-vision { --ios-bg: #F2F2F7; --text-color: #1c1c1e; --card-bg: #FFFFFF; }
        body.low-vision { --ios-bg: #000000; --text-color: #FFFF00; --card-bg: #1c1c1e; }
        body.color-blind { --ios-bg: #E1E1E1; --text-color: #000000; --ios-blue: #0055AA; }

        body { 
            background-color: var(--ios-bg); font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            margin: 0; padding-top: 70px; transition: 0.3s;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            position: fixed; top: 0; width: 100%; height: 65px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(20px);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; box-sizing: border-box; border-bottom: .5px solid #C6C6C8; z-index: 1000;
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .drawer {
            position: fixed; top: 0; right: -280px; width: 280px; height: 100%;
            background: var(--card-bg); box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: 0.3s; z-index: 2000; padding-top: 60px;
        }
        .drawer.open { right: 0; }
        .drawer-item { padding: 18px 20px; border-bottom: 0.5px solid #eee; cursor: pointer; color: var(--text-color); font-weight: 600; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
        .toolbar {
            background: var(--card-bg); margin: 10px; padding: 12px;
            border-radius: 15px; display: flex; justify-content: space-around;
            align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .tool-btn { border: none; background: #eee; padding: 8px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© */
        .dua-item-row { 
            padding: 18px 20px; background: var(--card-bg); margin: 10px 15px; 
            border-radius: 15px; border: 0.5px solid #E5E5EA; 
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            font-family: 'Amiri', serif; font-size: 18px; font-weight: bold;
        }

        /* Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ø§Ø¡ Ø§Ù„ÙƒØ§Ù…Ù„Ø© */
        #fullDuaView {
            position: fixed; inset: 0; background: var(--ios-bg); z-index: 3000;
            display: none; flex-direction: column; padding: 25px; overflow-y: auto;
        }
        .dua-full-text {
            font-family: 'Amiri', serif; line-height: 1.8; text-align: justify;
            white-space: pre-wrap; color: var(--text-color); margin-top: 20px;
        }

        .overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1500; }
    </style>
</head>
<body class="normal-vision">

    <header class="header">
        <div onclick="toggleDrawer()" style="font-size: 28px; cursor: pointer; color: var(--ios-blue);">â˜°</div>
        <h1 style="font-size: 18px; margin: 0; color: var(--text-color);">Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø±</h1>
        <div onclick="location.href='news.html'" style="font-size: 24px; cursor: pointer;">ğŸ </div>
    </header>

    <div class="toolbar">
        <div>
            <button class="tool-btn" onclick="changeFontSize(2)">A+</button>
            <button class="tool-btn" onclick="changeFontSize(-2)">A-</button>
        </div>
        <select onchange="changeVision(this.value)" class="tool-btn">
            <option value="normal-vision">Ù†Ø¸Ù€Ø± Ø·Ø¨ÙŠØ¹ÙŠ</option>
            <option value="low-vision">Ø¶Ø¹Ù Ø¨ØµØ±</option>
            <option value="color-blind">Ø¹Ù…Ù‰ Ø£Ù„ÙˆØ§Ù†</option>
        </select>
    </div>

    <div id="drawerOverlay" class="overlay" onclick="toggleDrawer()"></div>
    <div id="drawer" class="drawer">
        <div style="padding: 20px; font-weight: 800; border-bottom: 2px solid var(--ios-blue); color: var(--ios-blue);">ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</div>
        <div id="categoriesList"></div>
    </div>

    <div id="duasContainer">
        <p style="text-align: center; margin-top: 50px; color: gray;">Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙØ§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© â˜°</p>
    </div>

    <div id="fullDuaView">
        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom: 1px solid #ddd; padding-bottom: 15px;">
            <button onclick="closeFullDua()" style="border:none; background:var(--ios-red); color:white; padding:8px 18px; border-radius:10px; font-weight:bold;">Ø¥ØºÙ„Ø§Ù‚ âœ•</button>
            <h2 id="viewDuaTitle" style="margin:0; font-size:20px; font-family:'Amiri', serif;"></h2>
        </div>
        <div id="viewDuaText" class="dua-full-text"></div>
    </div>

<script type="module">
    import { db } from './config.js';
    import { collection, onSnapshot, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    let currentFontSize = 22; // Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø®Ø· Ø§Ù„Ø¹Ø±Ø¨ÙŠ

    // 1. Ø¬Ù„Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
    onSnapshot(collection(db, "DuaCategories"), (snap) => {
        const list = document.getElementById('categoriesList');
        list.innerHTML = "";
        snap.forEach(doc => {
            const cat = doc.data();
            const div = document.createElement('div');
            div.className = 'drawer-item';
            div.innerText = cat.name;
            div.onclick = () => { loadTitles(cat.name); toggleDrawer(); };
            list.appendChild(div);
        });
    });

    // 2. Ø¬Ù„Ø¨ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØªØµÙ†ÙŠÙ
    window.loadTitles = async (categoryName) => {
        const container = document.getElementById('duasContainer');
        container.innerHTML = `<h3 style="text-align:center; color:var(--ios-blue); margin: 20px 0;">Ù‚Ø³Ù…: ${categoryName}</h3>`;
        
        const q = query(collection(db, "Duas"), where("category", "==", categoryName));
        const snap = await getDocs(q);
        
        if (snap.empty) {
            container.innerHTML += "<p style='text-align:center;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ø¹ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
            return;
        }

        snap.forEach(docSnap => {
            const dua = docSnap.data();
            const div = document.createElement('div');
            div.className = 'dua-item-row';
            div.innerHTML = `<span>${dua.title}</span> <span style="color:var(--ios-blue); font-size: 14px;">Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ø§Ø¡ â†</span>`;
            div.onclick = () => showFullDua(dua.title, dua.text);
            container.appendChild(div);
        });
    };

    // 3. Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
    window.showFullDua = (title, text) => {
        const view = document.getElementById('fullDuaView');
        const viewTitle = document.getElementById('viewDuaTitle');
        const viewText = document.getElementById('viewDuaText');
        
        view.style.display = 'flex';
        // ØªØ­Ø¯ÙŠØ« Ù†Ù…Ø· Ø§Ù„Ø±Ø¤ÙŠØ© ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø£ÙŠØ¶Ø§Ù‹
        view.style.backgroundColor = getComputedStyle(document.body).getPropertyValue('--ios-bg');
        
        viewTitle.innerText = title;
        viewText.innerText = text;
        viewText.style.fontSize = currentFontSize + 'px';
        viewText.style.color = getComputedStyle(document.body).getPropertyValue('--text-color');
    };

    window.closeFullDua = () => {
        document.getElementById('fullDuaView').style.display = 'none';
    };

    // 4. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø¬Ù… Ø§Ù„Ø®Ø·
    window.changeFontSize = (step) => {
        currentFontSize += step;
        if(currentFontSize < 16) currentFontSize = 16;
        if(currentFontSize > 50) currentFontSize = 50;
        
        const viewText = document.getElementById('viewDuaText');
        if(viewText) viewText.style.fontSize = currentFontSize + 'px';
    };

    // 5. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø±Ø¤ÙŠØ©
    window.changeVision = (mode) => {
        document.body.className = mode;
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙÙˆØ±Ø§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù…ÙØªÙˆØ­Ø©
        const view = document.getElementById('fullDuaView');
        if(view.style.display === 'flex') {
            setTimeout(() => {
                view.style.backgroundColor = getComputedStyle(document.body).getPropertyValue('--ios-bg');
                document.getElementById('viewDuaText').style.color = getComputedStyle(document.body).getPropertyValue('--text-color');
            }, 50);
        }
    };

    window.toggleDrawer = () => {
        const d = document.getElementById('drawer');
        const o = document.getElementById('drawerOverlay');
        const isOpen = d.classList.contains('open');
        d.classList.toggle('open');
        o.style.display = isOpen ? 'none' : 'block';
    };
</script>
</body>
</html>
