<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†ØµØ© Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© | Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</title>
    
    <style>
        :root {
            --ios-blue: #007AFF; --ios-bg: #F2F2F7; --card-bg: #FFFFFF;
            --text-color: #1c1c1e; --font-size: 18px;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø±Ø¤ÙŠØ© */
        body.normal-vision { --ios-bg: #F2F2F7; --text-color: #1c1c1e; --card-bg: #FFFFFF; }
        body.low-vision { --ios-bg: #000000; --text-color: #FFFF00; --card-bg: #1c1c1e; } /* ØªØ¨Ø§ÙŠÙ† Ø¹Ø§Ù„ÙŠ Ø£ØµÙØ± Ø¹Ù„Ù‰ Ø£Ø³ÙˆØ¯ */
        body.color-blind { --ios-bg: #E1E1E1; --text-color: #000000; --ios-blue: #0055AA; }

        body { 
            background-color: var(--ios-bg); font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            margin: 0; padding-top: 70px; transition: 0.3s;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            position: fixed; top: 0; width: 100%; height: 65px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(20px);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; box-sizing: border-box; border-bottom: .5px solid #C6C6C8; z-index: 1000;
        }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Drawer) */
        .drawer {
            position: fixed; top: 0; right: -280px; width: 280px; height: 100%;
            background: var(--card-bg); box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: 0.3s; z-index: 2000; padding-top: 60px;
        }
        .drawer.open { right: 0; }
        .drawer-item { padding: 15px 20px; border-bottom: 0.5px solid #eee; cursor: pointer; color: var(--text-color); font-weight: 600; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø¯ÙˆØ§Øª (ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù†) */
        .toolbar {
            background: var(--card-bg); margin: 10px; padding: 10px;
            border-radius: 15px; display: flex; justify-content: space-around;
            align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .tool-btn { border: none; background: #eee; padding: 8px 12px; border-radius: 10px; font-weight: bold; cursor: pointer; }

        /* Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø¹Ø§Ø¡ */
        .dua-card {
            background: var(--card-bg); margin: 15px; padding: 20px;
            border-radius: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            line-height: 1.6; text-align: justify; /* Ø¶Ø¨Ø· Ø§Ù„Ù†Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯ÙˆØ¯ */
            color: var(--text-color); font-size: var(--font-size);
            border: 0.5px solid #E5E5EA;
        }
        .dua-title { color: var(--ios-blue); font-weight: 800; margin-bottom: 10px; display: block; border-bottom: 1px solid #eee; padding-bottom: 5px; }

        .overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1500; }
    </style>
</head>
<body class="normal-vision">

    <header class="header">
        <div onclick="toggleDrawer()" style="font-size: 28px; cursor: pointer; color: var(--ios-blue);">â˜°</div>
        <h1 style="font-size: 18px; margin: 0; color: var(--text-color);">Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© ÙˆØ§Ù„Ø£Ø°ÙƒØ§Ø±</h1>
        <div onclick="location.href='news.html'" style="font-size: 24px; cursor: pointer;">ğŸ </div>
    </header>

    <div class="toolbar">
        <div>
            <button class="tool-btn" onclick="changeFontSize(2)">A+</button>
            <button class="tool-btn" onclick="changeFontSize(-2)">A-</button>
        </div>
        <select onchange="changeVision(this.value)" class="tool-btn">
            <option value="normal-vision">Ù†Ø¸Ù€Ø± Ø·Ø¨ÙŠØ¹ÙŠ</option>
            <option value="low-vision">Ø¶Ø¹Ù Ø¨ØµØ±</option>
            <option value="color-blind">Ø¹Ù…Ù‰ Ø£Ù„ÙˆØ§Ù†</option>
        </select>
    </div>

    <div id="drawerOverlay" class="overlay" onclick="toggleDrawer()"></div>
    <div id="drawer" class="drawer">
        <div style="padding: 20px; font-weight: 800; border-bottom: 2px solid var(--ios-blue);">ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</div>
        <div id="categoriesList">
            <p style="padding: 20px; color: gray;">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…...</p>
        </div>
    </div>

    <div id="duasContainer">
        <p style="text-align: center; margin-top: 50px; color: var(--ios-gray);">Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙØ§Ù‹ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©</p>
    </div>

<script type="module">
    import { db } from './config.js';
    import { collection, onSnapshot, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    let currentFontSize = 18;

    // 1. Ø¬Ù„Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
    async function loadCategories() {
        // Ù†ÙØªØ±Ø¶ Ø£Ù† Ù„Ø¯ÙŠÙƒ Ù…Ø¬Ù…ÙˆØ¹Ø© ÙÙŠ Firestore Ø§Ø³Ù…Ù‡Ø§ DuaSettings Ø£Ùˆ ØªØ¬Ù„Ø¨Ù‡Ø§ Ù…Ù† Ø­Ù‚Ù„ ÙÙŠ Ø§Ù„Ø£Ø¯Ø¹ÙŠØ©
        const q = query(collection(db, "DuaCategories")); 
        onSnapshot(collection(db, "DuaCategories"), (snap) => {
            const list = document.getElementById('categoriesList');
            list.innerHTML = "";
            snap.forEach(doc => {
                const cat = doc.data();
                const div = document.createElement('div');
                div.className = 'drawer-item';
                div.innerText = cat.name;
                div.onclick = () => {
                    loadDuas(cat.name);
                    toggleDrawer();
                };
                list.appendChild(div);
            });
        });
    }

    // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø®ØªØ¨Ø±
    window.loadDuas = async (categoryName) => {
        const container = document.getElementById('duasContainer');
        container.innerHTML = `<p style="text-align:center; padding:20px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>`;
        
        const q = query(collection(db, "Duas"), where("category", "==", categoryName));
        const snap = await getDocs(q);
        
        container.innerHTML = "";
        if (snap.empty) {
            container.innerHTML = "<p style='text-align:center;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¯Ø¹ÙŠØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
            return;
        }

        snap.forEach(doc => {
            const dua = doc.data();
            const card = document.createElement('div');
            card.className = 'dua-card';
            card.innerHTML = `
                <span class="dua-title">${dua.title}</span>
                <div class="dua-text">${dua.text}</div>
            `;
            container.appendChild(card);
        });
        updateTextSize(); // Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ø¹ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    };

    // 3. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø®Ø·
    window.changeFontSize = (step) => {
        currentFontSize += step;
        if(currentFontSize < 14) currentFontSize = 14;
        if(currentFontSize > 40) currentFontSize = 40;
        updateTextSize();
    };

    function updateTextSize() {
        document.querySelectorAll('.dua-text').forEach(el => {
            el.style.fontSize = currentFontSize + 'px';
        });
    }

    // 4. Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø±Ø¤ÙŠØ©
    window.changeVision = (mode) => {
        document.body.className = mode;
    };

    // 5. ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    window.toggleDrawer = () => {
        const d = document.getElementById('drawer');
        const o = document.getElementById('drawerOverlay');
        const isOpen = d.classList.contains('open');
        if(isOpen) {
            d.classList.remove('open');
            o.style.display = 'none';
        } else {
            d.classList.add('open');
            o.style.display = 'block';
        }
    };

    loadCategories();
</script>

</body>
</html>
