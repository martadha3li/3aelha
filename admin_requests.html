<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-container { padding: 15px; padding-bottom: 50px; }
        .section-card { 
            background: white; border-radius: 20px; padding: 20px; 
            margin-bottom: 20px; box-shadow: var(--shadow); 
        }
        .section-title { 
            display: flex; align-items: center; gap: 10px; 
            margin-bottom: 20px; color: var(--primary); border-bottom: 1px solid #eee; padding-bottom: 10px;
        }
        .control-row { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 15px 0; border-bottom: 1px dashed #f0f0f0; 
        }
        .control-row:last-child { border: none; }
        .control-info { flex: 1; margin-left: 10px; }
        .control-info b { display: block; font-size: 14px; margin-bottom: 4px; }
        .control-info small { color: #8e8e93; font-size: 11px; }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø§Ù„Ø© */
        .status-btn { 
            padding: 8px 16px; border-radius: 12px; border: none; 
            font-family: inherit; font-weight: bold; cursor: pointer; min-width: 90px; transition: 0.3s;
        }
        .btn-send { background: #5856d6; color: white; }
        .btn-send:active { transform: scale(0.95); }
    </style>
</head>
<body style="background: #f8f9fa;">

    <div class="top-bar">
        <button onclick="location.href='admin.html'" style="border:none; background:none; font-size:22px;">â¡ï¸</button>
        <b>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ù„Ø®ØµÙˆØµÙŠØ©</b>
        <div style="width:20px;"></div>
    </div>

    <div class="admin-container">
        
        <div class="section-card">
            <div class="section-title"><h3>ğŸš¨ Ø·Ù„Ø¨Ø§Øª ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3></div>
            
            <div class="control-row">
                <div class="control-info">
                    <b>ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ù†Ø§Ø«</b>
                    <small>Ø·Ù„Ø¨ (Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ø±ÙØŒ Ø§Ù„Ø¬ÙˆØ§Ù„ØŒ ØµÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¨Ø©) Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ§Ù‹</small>
                </div>
                <button class="btn-send status-btn" onclick="triggerRequest('requireFemaleUpdate')">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>

            <div class="control-row">
                <div class="control-info">
                    <b>Ø·Ù„Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯</b>
                    <small>Ø¥Ø¬Ø¨Ø§Ø± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø¹Ù„Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯Ù‡Ù…</small>
                </div>
                <button class="btn-send status-btn" onclick="triggerRequest('requireDOBUpdate')">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>

            <div class="control-row">
                <div class="control-info">
                    <b>ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</b>
                    <small>Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</small>
                </div>
                <button class="btn-send status-btn" onclick="triggerRequest('requirePhoneUpdate')">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>

        <div class="section-card">
            <div class="section-title"><h3>ğŸ’¬ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙˆØ§Ù„Ø¨Ø­Ø«</h3></div>
            
            <div class="control-row">
                <div class="control-info">
                    <b>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</b>
                    <small>ØªØ¹Ø·ÙŠÙ„ Ø£Ùˆ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© Ù„Ù„ÙƒÙ„</small>
                </div>
                <button id="publicChatBtn" class="status-btn" onclick="toggleOption('publicChatEnabled')">...</button>
            </div>

            <div class="control-row">
                <div class="control-info">
                    <b>Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø®Ø§ØµØ©</b>
                    <small>Ù…Ù†Ø¹ Ø£Ùˆ ØªÙØ¹ÙŠÙ„ Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ù„Ø¨Ø¹Ø¶Ù‡Ù…</small>
                </div>
                <button id="privateChatBtn" class="status-btn" onclick="toggleOption('privateChatEnabled')">...</button>
            </div>

            <div class="control-row">
                <div class="control-info">
                    <b>Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù†Ø³ÙŠÙ†</b>
                    <small>Ù…Ù†Ø¹ Ø§Ù„Ø°ÙƒÙˆØ± Ù…Ù† Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ø¥Ù†Ø§Ø« ÙˆØ§Ù„Ø¹ÙƒØ³</small>
                </div>
                <button id="crossGenderBtn" class="status-btn" onclick="toggleOption('crossGenderChat')">...</button>
            </div>
        </div>

        <p style="text-align: center; font-size: 11px; color: gray;">* Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ© ØªØ¸Ù‡Ø± Ù„Ù„Ø¹Ø¶Ùˆ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ø¯Ø®ÙˆÙ„ Ù„Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.</p>
    </div>

<script type="module">
    import { db } from './config.js';
    import { doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const globalSettingsRef = doc(db, "Settings", "GlobalSettings");

    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ« (ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØª Ù„ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
    window.triggerRequest = async (field) => {
        if(confirm("Ø³ÙŠØªÙ… Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ Ø¯Ø®ÙˆÙ„Ù‡Ù…. Ø§Ø³ØªÙ…Ø±Ø§Ø±ØŸ")) {
            await updateDoc(globalSettingsRef, { 
                [field]: Date.now() 
            });
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        }
    };

    // Ø¯Ø§Ù„Ø© Ù„ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© (ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„)
    window.toggleOption = async (field) => {
        const snap = await getDoc(globalSettingsRef);
        const currentValue = snap.data()[field];
        await updateDoc(globalSettingsRef, { [field]: !currentValue });
        loadSettings(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    };

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    async function loadSettings() {
        const snap = await getDoc(globalSettingsRef);
        if (!snap.exists()) {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ù„Ø£ÙˆÙ„ Ù…Ø±Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            await setDoc(globalSettingsRef, {
                publicChatEnabled: true,
                privateChatEnabled: true,
                crossGenderChat: true,
                requireFemaleUpdate: 0,
                requireDOBUpdate: 0,
                requirePhoneUpdate: 0
            });
            loadSettings();
            return;
        }

        const data = snap.data();
        updateButtonStyle('publicChatBtn', data.publicChatEnabled);
        updateButtonStyle('privateChatBtn', data.privateChatEnabled);
        updateButtonStyle('crossGenderBtn', data.crossGenderChat);
    }

    function updateButtonStyle(btnId, status) {
        const btn = document.getElementById(btnId);
        if (status) {
            btn.innerText = "Ù…ÙØ¹Ù„ âœ…";
            btn.style.background = "#34c759"; // Ø£Ø®Ø¶Ø±
            btn.style.color = "white";
        } else {
            btn.innerText = "Ù…Ø¹Ø·Ù„ âŒ";
            btn.style.background = "#8e8e93"; // Ø±Ù…Ø§Ø¯ÙŠ
            btn.style.color = "white";
        }
    }

    loadSettings();
</script>
</body>
</html>
