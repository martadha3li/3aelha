<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>الأخبار</title>
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; }
        nav { width: 200px; background: #333; color: white; height: 100vh; padding: 15px; }
        main { flex: 1; padding: 20px; }
        .admin-btn { display: none; position: fixed; bottom: 20px; left: 20px; background: red; color: white; padding: 15px; border-radius: 50px; text-decoration: none; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        .news-card { border-bottom: 1px solid #ddd; padding: 15px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <nav>
        <h3>التصنيفات</h3>
        <hr>
        <div id="cats">جاري التحميل...</div>
        <br>
        <a href="profile.html" style="color: yellow;">ملفي الشخصي</a>
    </nav>
    <main>
        <h2>آخر الأخبار</h2>
        <div id="newsList"></div>
    </main>

    <a href="admin.html" id="adminBtn" class="admin-btn">⚙️ لوحة الإدارة</a>

    <script type="module">
        import { auth, db } from './config.js';
        import { doc, getDoc, collection, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                const snap = await getDoc(doc(db, "Users", user.uid));
                if (snap.exists() && (snap.data().role === 'admin')) {
                    document.getElementById('adminBtn').style.display = 'block';
                }
            } else { window.location.href = "index.html"; }
        });

        // جلب الأخبار
        const q = query(collection(db, "News"), orderBy("date", "desc"));
        onSnapshot(q, (snapshot) => {
            const list = document.getElementById('newsList');
            list.innerHTML = "";
            snapshot.forEach(d => {
                const n = d.data();
                list.innerHTML += `<div class="news-card"><h4>${n.title}</h4><p>${n.body}</p><small>${n.cat} - ${n.date.toDate().toLocaleDateString()}</small></div>`;
            });
        });
    </script>
</body>
</html>
