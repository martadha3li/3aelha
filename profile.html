<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; text-align: center; }
        .p-card { max-width: 450px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .profile-pic { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary); margin-bottom: 15px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-save { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="p-card">
    <h2>Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ø§Ù„Ø´Ø®ØµÙŠØ© ğŸ‘¤</h2>
    <img id="pPreview" class="profile-pic" src="https://via.placeholder.com/120">
    <input type="file" accept="image/*" onchange="uploadProfileImg()">
    <input type="hidden" id="pImgBase64">

    <input type="text" id="pName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
    <input type="text" id="pPhone" readonly style="background:#eee;" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (ØªØ¹Ø¯ÙŠÙ„ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)">
    <input type="email" id="pEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
    <input type="password" id="pPass" placeholder="ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©">

    <button class="btn-save" onclick="updateProfile()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
</div>

<script type="module">
    import { auth, db } from './config.js';
    import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { updatePassword, updateEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    auth.onAuthStateChanged(async user => {
        if(user) {
            const snap = await getDoc(doc(db, "Users", user.uid));
            const u = snap.data();
            document.getElementById('pName').value = u.fullName;
            document.getElementById('pPhone').value = u.phone;
            document.getElementById('pEmail').value = u.email;
            if(u.profileImg) {
                document.getElementById('pPreview').src = u.profileImg;
                document.getElementById('pImgBase64').value = u.profileImg;
            }
        }
    });

    window.uploadProfileImg = () => {
        const file = document.querySelector('input[type=file]').files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            document.getElementById('pPreview').src = reader.result;
            document.getElementById('pImgBase64').value = reader.result;
        }
        if (file) reader.readAsDataURL(file);
    };

    window.updateProfile = async () => {
        const user = auth.currentUser;
        const newName = document.getElementById('pName').value;
        const newImg = document.getElementById('pImgBase64').value;
        const newPass = document.getElementById('pPass').value;

        await updateDoc(doc(db, "Users", user.uid), {
            fullName: newName,
            profileImg: newImg
        });

        if(newPass) await updatePassword(user, newPass);
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
    };
</script>
</body>
</html>
