<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; padding: 20px; }
        .p-card { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; }
        .readonly { background: #eee; cursor: not-allowed; }
        .btn-save { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .alert-phone { font-size: 12px; color: #e74c3c; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

<div class="p-card">
    <h2 style="text-align:center;">Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ ğŸ‘¤</h2>
    
    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
    <input type="text" id="pName">

    <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ (Ù„Ù„ØªØºÙŠÙŠØ± ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©):</label>
    <span class="alert-phone">* Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø£Ù…Ù†ÙŠØ©</span>
    <input type="text" id="pPhone" class="readonly" readonly>

    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
    <input type="email" id="pEmail">

    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
    <input type="text" id="pPass" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ø¥Ø°Ø§ Ù„Ø§ ØªØ±ÙŠØ¯ Ø§Ù„ØªØºÙŠÙŠØ±">

    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</label>
    <input type="date" id="pDOB">

    <button class="btn-save" onclick="saveProfile()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
    <button onclick="location.href='news.html'" style="width:100%; margin-top:10px; border:none; background:none; cursor:pointer; color:#777;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
</div>

<script type="module">
    import { auth, db } from './config.js';
    import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { updatePassword, updateEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    auth.onAuthStateChanged(async user => {
        if(user) {
            const snap = await getDoc(doc(db, "Users", user.uid));
            const u = snap.data();
            document.getElementById('pName').value = u.fullName;
            document.getElementById('pPhone').value = u.phone;
            document.getElementById('pEmail').value = u.email;
            document.getElementById('pDOB').value = u.dob || "";
        }
    });

    window.saveProfile = async () => {
        const user = auth.currentUser;
        const newName = document.getElementById('pName').value;
        const newEmail = document.getElementById('pEmail').value;
        const newPass = document.getElementById('pPass').value;
        const newDOB = document.getElementById('pDOB').value;

        try {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore
            await updateDoc(doc(db, "Users", user.uid), {
                fullName: newName,
                email: newEmail,
                dob: newDOB
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆØ§Ù„Ø¨Ø§Ø³ÙˆÙˆØ±Ø¯ ÙÙŠ Auth (ÙŠØªØ·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­Ø¯ÙŠØ«)
            if(newEmail !== user.email) await updateEmail(user, newEmail);
            if(newPass) await updatePassword(user, newPass);

            alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­!");
        } catch (e) {
            alert("Ø®Ø·Ø£: " + e.message + " (Ù‚Ø¯ ÙŠØªØ·Ù„Ø¨ Ø§Ù„Ø£Ù…Ø± Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©)");
        }
    };
</script>
</body>
</html>
