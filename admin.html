<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة الإدارة</title>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        section { background: white; border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
        input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; }
        button { padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; margin: 5px 0; }
        .user-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>
    <h1>لوحة تحكم المدير</h1>
    
    <section>
        <h3>إضافة خبر</h3>
        <input type="text" id="t" placeholder="العنوان">
        <textarea id="b" placeholder="المحتوى"></textarea>
        <input type="text" id="c" placeholder="التصنيف">
        <button id="addN">نشر الخبر</button>
    </section>

    <section>
        <h3>إدارة الأعضاء</h3>
        <div id="uList">جاري التحميل...</div>
    </section>

    <script type="module">
        import { auth, db } from './config.js';
        import { collection, addDoc, onSnapshot, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // التحقق من الصلاحية
        auth.onAuthStateChanged(async (u) => {
            const s = await getDoc(doc(db, "Users", u.uid));
            if (!u || s.data().role !== 'admin') window.location.href = "news.html";
        });

        // إضافة خبر
        document.getElementById('addN').onclick = async () => {
            await addDoc(collection(db, "News"), {
                title: document.getElementById('t').value,
                body: document.getElementById('b').value,
                cat: document.getElementById('c').value,
                date: new Date()
            });
            alert("تم النشر");
        };

        // عرض الأعضاء وتبديل حالتهم
        onSnapshot(collection(db, "Users"), (snap) => {
            const cont = document.getElementById('uList');
            cont.innerHTML = "";
            snap.forEach(d => {
                const u = d.data();
                cont.innerHTML += `<div class="user-row">
                    <span>${u.fullName}</span>
                    <button onclick="toggleActive('${d.id}', ${u.isActive})">${u.isActive ? 'تعطيل' : 'تفعيل'}</button>
                </div>`;
            });
        });

        window.toggleActive = async (id, status) => {
            await updateDoc(doc(db, "Users", id), { isActive: !status });
        };
    </script>
</body>
</html>
