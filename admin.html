<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø¯ÙŠØ±</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8f9fa; padding: 30px; }
        .container { max-width: 800px; margin: auto; }
        section { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
        h2 { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0056b3; }
        .user-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; }
        .status-active { color: green; font-weight: bold; }
        .status-blocked { color: red; font-weight: bold; }
        .btn-toggle { background: #6c757d; font-size: 12px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ğŸ”</h1>

    <section>
        <h2>Ù†Ø´Ø± Ø®Ø¨Ø± Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" id="newsTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¨Ø±">
        <textarea id="newsBody" rows="4" placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±"></textarea>
        <input type="text" id="newsCat" placeholder="Ø§Ù„ØªØµÙ†ÙŠÙ (Ù…Ø«Ù„Ø§Ù‹: Ø¹Ø§Ø¬Ù„ØŒ Ø±ÙŠØ§Ø¶Ø©)">
        <button id="btnPost">Ù†Ø´Ø± Ø§Ù„Ø®Ø¨Ø± Ø§Ù„Ø¢Ù†</button>
    </section>

    <section>
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
        <div id="usersList">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡...</div>
    </section>

    <a href="news.html" style="display:block; text-align:center; color:#666; text-decoration:none;">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø®Ø¨Ø§Ø±</a>
</div>

<script type="module">
    import { auth, db } from './config.js';
    import { collection, addDoc, onSnapshot, doc, updateDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©: Ø§Ù„ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¯ÙŠØ±
    auth.onAuthStateChanged(async (user) => {
        if (user) {
            const snap = await getDoc(doc(db, "Users", user.uid));
            if (!snap.exists() || snap.data().role !== 'admin') {
                window.location.href = "news.html";
            }
        } else { window.location.href = "index.html"; }
    });

    // Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø±
    document.getElementById('btnPost').onclick = async () => {
        const title = document.getElementById('newsTitle').value;
        const body = document.getElementById('newsBody').value;
        const cat = document.getElementById('newsCat').value;

        if (title && body) {
            await addDoc(collection(db, "News"), {
                title, body, cat, date: new Date()
            });
            alert("ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø®Ø¨Ø± Ø¨Ù†Ø¬Ø§Ø­!");
            document.getElementById('newsTitle').value = "";
            document.getElementById('newsBody').value = "";
        } else { alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); }
    };

    // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ÙˆØ§Ù„ØªØ­ÙƒÙ… ÙÙŠ ØªÙØ¹ÙŠÙ„Ù‡Ù…
    onSnapshot(collection(db, "Users"), (snap) => {
        const list = document.getElementById('usersList');
        list.innerHTML = "";
        snap.forEach(d => {
            const u = d.data();
            if (u.role !== 'admin') { // Ù„Ø§ ØªØ¸Ù‡Ø± Ø®ÙŠØ§Ø± ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± Ù†ÙØ³Ù‡
                list.innerHTML += `
                    <div class="user-row">
                        <div>
                            <strong>${u.fullName}</strong><br>
                            <small>${u.phone} | <span class="${u.isActive ? 'status-active' : 'status-blocked'}">${u.isActive ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}</span></small>
                        </div>
                        <button class="btn-toggle" onclick="window.updateStatus('${d.id}', ${u.isActive})">
                            ${u.isActive ? 'ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨' : 'ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨'}
                        </button>
                    </div>`;
            }
        });
    });

    // ÙˆØ¸ÙŠÙØ© ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø© (ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„)
    window.updateStatus = async (id, currentStatus) => {
        await updateDoc(doc(db, "Users", id), { isActive: !currentStatus });
    };
</script>

</body>
</html>
