<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة إدارة مواقيت الصلاة</title>
<style>
body{font-family:-apple-system;background:#f2f2f7;padding:20px}
.card{background:white;padding:15px;border-radius:15px;margin-bottom:15px}
input,button{padding:10px;border-radius:10px;border:1px solid #ccc}
button{background:#0A84FF;color:white;border:none;width:100%;margin-top:10px}
</style>
</head>
<body>

<div class="card">
<h3>تعديل الدقائق</h3>
<input type="number" id="fajrOff" placeholder="الفجر">
<input type="number" id="dhuhrOff" placeholder="الظهر">
<input type="number" id="asrOff" placeholder="العصر">
<input type="number" id="maghribOff" placeholder="المغرب">
<input type="number" id="ishaOff" placeholder="العشاء">
<button id="saveOffsets">حفظ التعديلات</button>
</div>

<div class="card">
<h3>إضافة مناسبة هجرية</h3>
<input type="text" id="eventDate" placeholder="مثال: 10 رمضان 1447">
<input type="text" id="eventTitle" placeholder="عنوان المناسبة">
<button id="addEvent">حفظ المناسبة</button>
</div>

<div class="card">
<h3>رفع صورة تقويم شهر (اختياري)</h3>
<input type="file" id="calendarImage" accept="image/*">
<button id="analyzeImage">تحليل الصورة</button>
<div id="analysisResult"></div>
</div>

<script type="module">
import { db } from './config.js';
import { doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// حفظ التعديلات
document.getElementById("saveOffsets").onclick=async()=>{
await setDoc(doc(db,"Settings","PrayerOffsets"),{
fajr:+fajrOff.value||0,
dhuhr:+dhuhrOff.value||0,
asr:+asrOff.value||0,
maghrib:+maghribOff.value||0,
isha:+ishaOff.value||0
});
alert("تم الحفظ ✅");
};

// إضافة مناسبة
document.getElementById("addEvent").onclick=async()=>{
let snap=await getDoc(doc(db,"Settings","HijriEvents"));
let events=snap.exists()?snap.data().events:[];
events.push({
date:eventDate.value,
title:eventTitle.value,
gregorian:new Date().toISOString()
});
await setDoc(doc(db,"Settings","HijriEvents"),{events});
alert("تمت إضافة المناسبة");
};

// تحليل صورة (OCR باستخدام Tesseract)
document.getElementById("analyzeImage").onclick=async()=>{
let file=document.getElementById("calendarImage").files[0];
if(!file) return alert("اختر صورة");

const { createWorker } = await import('https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.esm.min.js');
const worker = await createWorker('ara');
const { data:{ text } } = await worker.recognize(file);
await worker.terminate();

document.getElementById("analysisResult").innerText=text;

// هنا يمكنك كتابة خوارزمية لاستخراج المواقيت من النص
};
</script>
</body>
</html>
