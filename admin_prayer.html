<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª ÙˆØ§Ù„ØªÙ‚ÙˆÙŠÙ…</title>
    <style>
        :root { --ios-blue: #007AFF; --ios-bg: #F2F2F7; }
        body { background-color: var(--ios-bg); font-family: -apple-system, sans-serif; padding: 20px; direction: rtl; }
        .card { background: white; padding: 20px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; color: var(--ios-blue); font-size: 16px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        input, select { padding: 10px; border-radius: 10px; border: 1px solid #ddd; outline: none; }
        input[type="number"] { width: 70px; text-align: center; }
        button { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-save { background: var(--ios-blue); color: white; }
        .btn-event { background: #34C759; color: white; margin-top: 10px; }
    </style>
</head>
<body>

    <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
        <button onclick="location.href='admin.html'" style="width:auto; padding:8px 15px; background:#ddd; color:333;">Ø±Ø¬ÙˆØ¹</button>
        <h2 style="margin:0; font-size:18px;">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª ÙˆØ§Ù„ØªÙ‚ÙˆÙŠÙ…</h2>
    </div>

    <div class="card">
        <h3>1. ØªØ¹Ø¯ÙŠÙ„ Ø¯Ù‚Ø§Ø¦Ù‚ Ø§Ù„Ø£Ø­Ø³Ø§Ø¡ (Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡)</h3>
        <div class="row"><span>Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ</span> <input type="number" id="offImsak" value="0"></div>
        <div class="row"><span>Ø§Ù„ÙØ¬Ø±</span> <input type="number" id="offFajr" value="0"></div>
        <div class="row"><span>Ø§Ù„Ø´Ø±ÙˆÙ‚</span> <input type="number" id="offShuruq" value="0"></div>
        <div class="row"><span>Ø§Ù„Ø¸Ù‡Ø±</span> <input type="number" id="offDhuhr" value="0"></div>
        <div class="row"><span>Ø§Ù„Ù…ØºØ±Ø¨</span> <input type="number" id="offMaghrib" value="0"></div>
        <button class="btn-save" onclick="saveOffsets()">Ø­ÙØ¸ ÙØ±ÙˆÙ‚Ø§Øª Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ âœ…</button>
    </div>

    <div class="card">
        <h3>2. Ø¬Ø¯ÙˆÙ„Ø© Ù…Ù†Ø§Ø³Ø¨Ø© Ù‡Ø¬Ø±ÙŠØ© (Ø³Ù†ÙˆÙŠØ©)</h3>
        <div style="display: flex; gap: 8px; margin-bottom: 10px;">
            <input type="number" id="hDay" placeholder="ÙŠÙˆÙ…" min="1" max="30">
            <select id="hMonth" style="flex:1;">
                <option value="1">Ù…Ø­Ø±Ù…</option><option value="2">ØµÙØ±</option>
                <option value="3">Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„</option><option value="4">Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
                <option value="5">Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø£ÙˆÙ„Ù‰</option><option value="6">Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø¢Ø®Ø±Ø©</option>
                <option value="7">Ø±Ø¬Ø¨</option><option value="8">Ø´Ø¹Ø¨Ø§Ù†</option>
                <option value="9">Ø±Ù…Ø¶Ø§Ù†</option><option value="10">Ø´ÙˆØ§Ù„</option>
                <option value="11">Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©</option><option value="12">Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©</option>
            </select>
        </div>
        <input type="text" id="hEventTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©..." style="width:100%; box-sizing:border-box;">
        <button class="btn-event" onclick="saveHijriEvent()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ø³Ù†ÙˆÙŠ ğŸ—“ï¸</button>
    </div>

    <div class="card">
        <h3>3. Ù…Ù†Ø§Ø³Ø¨Ø© ÙŠØ¯ÙˆÙŠØ© (Ù„Ù„ÙŠÙˆÙ… ÙÙ‚Ø·)</h3>
        <input type="text" id="manualEvent" placeholder="ØªØ¸Ù‡Ø± ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ù†Ø§Ø³Ø¨Ø© Ù‡Ø¬Ø±ÙŠØ©" style="width:100%; box-sizing:border-box;">
        <button class="btn-save" style="margin-top:10px; background:#8E8E93;" onclick="saveManualEvent()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
    </div>

<script type="module">
    import { db } from './config.js';
    import { doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    async function loadData() {
        const snap = await getDoc(doc(db, "Settings", "PrayerConfig"));
        if(snap.exists()){
            const d = snap.data();
            document.getElementById('offImsak').value = d.offsetImsak || 0;
            document.getElementById('offFajr').value = d.offsetFajr || 0;
            document.getElementById('offShuruq').value = d.offsetShuruq || 0;
            document.getElementById('offDhuhr').value = d.offsetDhuhr || 0;
            document.getElementById('offMaghrib').value = d.offsetMaghrib || 0;
            document.getElementById('manualEvent').value = d.event || "";
        }
    }

    window.saveOffsets = async () => {
        const data = {
            offsetImsak: parseInt(document.getElementById('offImsak').value),
            offsetFajr: parseInt(document.getElementById('offFajr').value),
            offsetShuruq: parseInt(document.getElementById('offShuruq').value),
            offsetDhuhr: parseInt(document.getElementById('offDhuhr').value),
            offsetMaghrib: parseInt(document.getElementById('offMaghrib').value),
        };
        await setDoc(doc(db, "Settings", "PrayerConfig"), data, {merge:true});
        alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª");
    };

    window.saveHijriEvent = async () => {
        const d = document.getElementById('hDay').value;
        const m = document.getElementById('hMonth').value;
        const t = document.getElementById('hEventTitle').value;
        if(!d || !t) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        await setDoc(doc(db, "HijriEvents", `${d}-${m}`), { day:parseInt(d), month:parseInt(m), title:t });
        alert("ØªÙ…Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­!");
        document.getElementById('hEventTitle').value = "";
    };

    window.saveManualEvent = async () => {
        const t = document.getElementById('manualEvent').value;
        await updateDoc(doc(db, "Settings", "PrayerConfig"), { event: t });
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø§Ù„ÙŠØ¯ÙˆÙŠØ©");
    };

    loadData();
</script>
</body>
</html>
