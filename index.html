<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home System | Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù†Ø²Ù„ Ø§Ù„Ø°ÙƒÙŠ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        :root { --ig-gray: #8e8e8e; --ig-red: #ff3040; }
        body { background-color: #fafafa; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        /* Navbar Customization */
        .navbar { background: white; border-bottom: 1px solid #dbdbdb; sticky-top; }
        .nav-icons i { font-size: 1.5rem; cursor: pointer; margin-left: 15px; color: #262626; }

        /* Instagram Style News Card */
        .news-post { background: white; border: 1px solid #dbdbdb; border-radius: 8px; margin-bottom: 25px; max-width: 600px; margin-left: auto; margin-right: auto; }
        .post-header { padding: 14px; display: flex; justify-content: space-between; align-items: center; }
        .post-content { padding: 0 14px 14px; border-bottom: 1px solid #efefef; }
        .post-actions { padding: 10px 14px; display: flex; gap: 15px; }
        .post-actions i { font-size: 1.6rem; cursor: pointer; transition: 0.2s; }
        .bi-heart-fill { color: var(--ig-red); }
        .likes-count, .view-comments { font-weight: 600; cursor: pointer; font-size: 0.9rem; padding: 0 14px; margin-bottom: 5px; }
        .comment-section { padding: 10px 14px; background: #fdfdfd; display: none; border-top: 1px solid #efefef; }
        
        /* Admin Tools */
        .admin-badge { background: #eee; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; }
        .stopped-news { opacity: 0.6; border: 2px dashed red; }
        .stopped-label { color: red; font-weight: bold; font-size: 0.8rem; }

        /* Tables & Admin Panel */
        .admin-card { background: white; border: 1px solid #dbdbdb; border-radius: 8px; padding: 20px; margin-bottom: 30px; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg sticky-top mb-4">
    <div class="container d-flex justify-content-between align-items-center">
        <span class="navbar-brand fw-bold">ğŸ  Ø³ÙƒÙ† Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</span>
        <div class="nav-icons d-flex align-items-center">
            <i class="bi bi-gear-fill" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª" onclick="toggleAdminPanel()"></i>
            <i class="bi bi-box-arrow-right text-danger" title="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"></i>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-lg-8">
            <div class="d-flex justify-content-between align-items-center mb-4 px-2">
                <h5 class="fw-bold">Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</h5>
                <button class="btn btn-dark btn-sm rounded-pill" data-bs-toggle="modal" data-bs-target="#newsModal">
                    <i class="bi bi-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø®Ø¨Ø±
                </button>
            </div>
            <div id="newsFeed"></div>
        </div>

        <div id="adminPanel" class="col-lg-4 d-none">
            <div class="admin-card">
                <h5 class="fw-bold mb-3"><i class="bi bi-sliders"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h5>
                <div class="mb-3">
                    <input type="text" id="memberName" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                    <div class="d-flex gap-2 mb-3" style="font-size: 0.8rem;">
                        <input type="checkbox" id="canWash"> ØºØ³ÙŠÙ„ | 
                        <input type="checkbox" id="canClean"> Ù†Ø¸Ø§ÙØ© | 
                        <input type="checkbox" id="canCook"> Ø·Ø¨Ø®
                    </div>
                    <button onclick="addMember()" class="btn btn-primary btn-sm w-100">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ</button>
                </div>
                <hr>
                <h6>Ø§Ù„Ù…Ù‡Ù…Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h6>
                <button onclick="generateSchedules()" class="btn btn-success btn-sm w-100 mb-3">ğŸ² ØªÙˆØ²ÙŠØ¹ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¬Ø¯ÙŠØ¯</button>
                <div id="membersList" class="small"></div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="newsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="modalTitle">Ø£Ù†Ø´Ø¦ Ù…Ù†Ø´ÙˆØ±Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editNewsId">
                <input type="text" id="newsTitleInput" class="form-control mb-3 border-0 bg-light" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¨Ø±...">
                <textarea id="newsContentInput" class="form-control border-0 bg-light" rows="4" placeholder="Ø¨Ù…Ø§Ø°Ø§ ØªÙÙƒØ±ØŸ"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="handleNewsSubmit()" class="btn btn-primary w-100 rounded-pill">Ù†Ø´Ø±</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="likesModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header p-2"><h6 class="modal-title m-auto">Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª</h6></div>
            <div class="modal-body p-2 text-center" id="likesListBody"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    let news = JSON.parse(localStorage.getItem('smart_news')) || [];
    let members = JSON.parse(localStorage.getItem('smart_members')) || [];

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø®Ø¨Ø§Ø± ---

    function handleNewsSubmit() {
        const id = document.getElementById('editNewsId').value;
        const title = document.getElementById('newsTitleInput').value;
        const content = document.getElementById('newsContentInput').value;

        if (id) {
            // ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            const idx = news.findIndex(n => n.id == id);
            news[idx].title = title;
            news[idx].content = content;
        } else {
            // ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
            news.unshift({
                id: Date.now(),
                title,
                content,
                likes: [],
                comments: [],
                status: 'active',
                date: new Date().toLocaleDateString('ar-SA')
            });
        }
        saveAndRender();
        bootstrap.Modal.getInstance(document.getElementById('newsModal')).hide();
        document.getElementById('editNewsId').value = ""; // ØªØµÙÙŠØ± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    }

    function toggleLike(newsId) {
        const idx = news.findIndex(n => n.id == newsId);
        const user = "Ø£Ù†Øª"; // ØªØ¬Ø±ÙŠØ¨ÙŠ: ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡ Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
        const likeIdx = news[idx].likes.indexOf(user);
        
        if (likeIdx > -1) news[idx].likes.splice(likeIdx, 1);
        else news[idx].likes.push(user);
        
        saveAndRender();
    }

    function showLikes(newsId) {
        const item = news.find(n => n.id == newsId);
        document.getElementById('likesListBody').innerHTML = item.likes.length ? item.likes.join('<br>') : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ø¬Ø¨ÙŠÙ† Ø¨Ø¹Ø¯";
        new bootstrap.Modal(document.getElementById('likesModal')).show();
    }

    function toggleComments(newsId) {
        const div = document.getElementById(`comments-${newsId}`);
        div.style.display = (div.style.display === 'none' || div.style.display === '') ? 'block' : 'none';
    }

    function addComment(event, newsId) {
        if (event.key === "Enter" && event.target.value.trim() !== "") {
            const idx = news.findIndex(n => n.id == newsId);
            news[idx].comments.push({ user: "Ù…Ø³ØªØ®Ø¯Ù…", text: event.target.value });
            event.target.value = "";
            saveAndRender();
        }
    }

    function editNews(newsId) {
        const item = news.find(n => n.id == newsId);
        document.getElementById('editNewsId').value = item.id;
        document.getElementById('newsTitleInput').value = item.title;
        document.getElementById('newsContentInput').value = item.content;
        document.getElementById('modalTitle').innerText = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±";
        new bootstrap.Modal(document.getElementById('newsModal')).show();
    }

    function deleteNews(newsId) {
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø®Ø¨Ø± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            news = news.filter(n => n.id != newsId);
            saveAndRender();
        }
    }

    function toggleStatus(newsId) {
        const idx = news.findIndex(n => n.id == newsId);
        news[idx].status = news[idx].status === 'active' ? 'stopped' : 'active';
        saveAndRender();
    }

    // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ---

    function toggleAdminPanel() {
        document.getElementById('adminPanel').classList.toggle('d-none');
    }

    function addMember() {
        const name = document.getElementById('memberName').value;
        if (!name) return;
        members.push({
            id: Date.now(),
            name,
            canWash: document.getElementById('canWash').checked,
            canClean: document.getElementById('canClean').checked,
            canCook: document.getElementById('canCook').checked,
            onVacation: false
        });
        saveAndRender();
    }

    // --- Ø§Ù„Ø±Ø³Ù… ÙˆØ§Ù„Ø­ÙØ¸ ---

    function saveAndRender() {
        localStorage.setItem('smart_news', JSON.stringify(news));
        localStorage.setItem('smart_members', JSON.stringify(members));
        render();
    }

    function render() {
        // Ø±Ø³Ù… Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
        const feed = document.getElementById('newsFeed');
        feed.innerHTML = news.map(item => `
            <div class="news-post ${item.status === 'stopped' ? 'stopped-news' : ''}">
                <div class="post-header">
                    <div>
                        <span class="fw-bold">${item.title}</span>
                        ${item.status === 'stopped' ? '<span class="stopped-label"> (Ù…ÙˆÙ‚ÙˆÙ)</span>' : ''}
                    </div>
                    <div class="dropdown">
                        <i class="bi bi-three-dots-vertical" data-bs-toggle="dropdown" style="cursor:pointer"></i>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="editNews(${item.id})">ØªØ¹Ø¯ÙŠÙ„</a></li>
                            <li><a class="dropdown-item" href="#" onclick="toggleStatus(${item.id})">${item.status === 'active' ? 'Ø¥ÙŠÙ‚Ø§Ù Ù†Ø´Ø±' : 'ØªÙØ¹ÙŠÙ„'}</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="#" onclick="deleteNews(${item.id})">Ø­Ø°Ù</a></li>
                        </ul>
                    </div>
                </div>
                <div class="post-content">${item.content}</div>
                <div class="post-actions">
                    <i class="bi ${item.likes.includes('Ø£Ù†Øª') ? 'bi-heart-fill' : 'bi-heart'}" onclick="toggleLike(${item.id})"></i>
                    <i class="bi bi-chat" onclick="toggleComments(${item.id})"></i>
                </div>
                <div class="likes-count" onclick="showLikes(${item.id})">${item.likes.length} Ø¥Ø¹Ø¬Ø§Ø¨</div>
                <div class="view-comments text-muted" onclick="toggleComments(${item.id})">Ø¹Ø±Ø¶ ${item.comments.length} ØªØ¹Ù„ÙŠÙ‚</div>
                
                <div class="comment-section" id="comments-${item.id}">
                    ${item.comments.map(c => `<div class="mb-1"><b>${c.user}:</b> ${c.text}</div>`).join('')}
                    <input type="text" class="form-control form-control-sm mt-2" placeholder="Ø£Ø¶Ù ØªØ¹Ù„ÙŠÙ‚Ø§Ù‹..." onkeypress="addComment(event, ${item.id})">
                </div>
                <div class="p-2"><small class="text-muted" style="font-size: 0.7rem">${item.date}</small></div>
            </div>
        `).join('');

        // Ø±Ø³Ù… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡
        const mList = document.getElementById('membersList');
        mList.innerHTML = members.map(m => `
            <div class="d-flex justify-content-between align-items-center mb-1 p-1 border-bottom">
                <span>${m.name}</span>
                <button class="btn btn-outline-danger btn-sm p-0 px-1" onclick="deleteMember(${m.id})">Ã—</button>
            </div>
        `).join('');
    }

    function deleteMember(id) {
        members = members.filter(m => m.id !== id);
        saveAndRender();
    }

    render();
</script>

</body>
</html>
